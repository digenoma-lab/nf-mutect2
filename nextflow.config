params {
    outdir = "results"
    max_memory = '120.GB'
    max_cpus = 32
    max_time = '48.h'
}

process {
    withName: 'BWA_MEM2_ALIGN' {
        cpus = 16
        memory = '64.GB'
        time = '24.h'
    }
    withName: 'GATK_MUTECT2_SCATTER' {
        cpus = 8
        memory = '32.GB'
        time = '12.h'
    }
    withName: 'GATK_MARKDUPLICATES' {
        cpus = 4
        memory = '16.GB'
        time = '6.h'
    }
    withName: 'GATK_BASERECALIBRATOR' {
        cpus = 4
        memory = '16.GB'
        time = '6.h'
    }
    withName: 'GATK_APPLYBQSR' {
        cpus = 4
        memory = '12.GB'
        time = '6.h'
    }
    withName: 'GATK_FILTERMUTECTCALLS' {
        cpus = 4
        memory = '16.GB'
        time = '4.h'
    }

    // One env for everything: gatk4, bwa-mem2, samtools, fastqc, multiqc
    conda = 'bioconda::gatk4=4.5.0.0 bioconda::bwa-mem2=2.2.1 bioconda::samtools=1.19 bioconda::fastqc=0.12.1 bioconda::multiqc=1.22'
    errorStrategy = 'retry'
    maxRetries = 1
    maxErrors = -1
}

executor {
    queueSize = 200
}

profiles {
    local {
        process.executor = 'local'
    }
    slurm {
        process.executor = 'slurm'
        process.queue = 'short'
        process.clusterOptions = '--export=ALL'
        executor {
            submitRateLimit = '10 sec'
        }
    }
}

timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
}
report {
    enabled = true
    file = "${params.outdir}/report.html"
}
trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
}
dag {
    enabled = true
    file = "${params.outdir}/dag.svg"
}
